!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@angular-extensions/elements",["exports","@angular/core","@angular/common"],t):t(((e=e||self)["angular-extensions"]=e["angular-extensions"]||{},e["angular-extensions"].elements={}),e.ng.core,e.ng.common)}(this,(function(e,t,o){"use strict";var r=new t.InjectionToken("LAZY_ELEMENT_CONFIGS"),n=new t.InjectionToken("LAZY_ELEMENT_ROOT_OPTIONS"),i=new t.InjectionToken("LAZY_ELEMENT_ROOT_GUARD"),a=new t.InjectionToken("LAZY_ELEMENTS_REGISTRY",{providedIn:"root",factory:function(){return new Map}});var l="@angular-extensions/elements";var s=function(){function e(e,t){this.registry=e,this.options=t,this.configs=[],t||(this.options={})}return e.prototype.addConfigs=function(e){var t=this;e.forEach((function(e){t.getElementConfig(e.tag)?console.warn(l+" - ElementConfig for tag '"+e.tag+"' was previously added, it will not be added multiple times, continue..."):(e.isAdded=!0,t.configs.push(e),(void 0!==e.preload?e.preload:t.options.preload)&&t.loadElement(e.url,e.tag,e.isModule,e.hooks))}))},e.prototype.getElementConfig=function(e){return this.configs.find((function(t){return t.tag===e}))},e.prototype.preload=function(e){var t=this,o=this.configs;e&&(o=this.configs.filter((function(t){return e.includes(t.tag)}))),o.forEach((function(e){return t.loadElement(e.url,e.tag,e.isModule,e.hooks)}))},e.prototype.loadElement=function(e,t,o,r){var n,i,a,s,c,d,u,p,m,f,h=this,v=this.getElementConfig(t);if(!e){if(!v||!v.url)throw new Error(l+" - url for <"+t+"> not found");e=v.url}if(void 0===o&&(o=v&&void 0!==v.isModule?v.isModule:this.options.isModule),!t)throw new Error(l+" - tag for '"+e+"' not found, the *axLazyElement has to be used on HTML element");if(!this.hasElement(e)){var y=this.addElement(e),g=document.createElement("script"),E=null!==(a=null!==(n=null==r?void 0:r.beforeLoad)&&void 0!==n?n:null===(i=null==v?void 0:v.hooks)||void 0===i?void 0:i.beforeLoad)&&void 0!==a?a:null===(c=null===(s=this.options)||void 0===s?void 0:s.hooks)||void 0===c?void 0:c.beforeLoad,L=null!==(p=null!==(d=null==r?void 0:r.afterLoad)&&void 0!==d?d:null===(u=null==v?void 0:v.hooks)||void 0===u?void 0:u.afterLoad)&&void 0!==p?p:null===(f=null===(m=this.options)||void 0===m?void 0:m.hooks)||void 0===f?void 0:f.afterLoad;o&&(g.type="module"),g.src=e,g.onload=function(){L?h.handleHook(L,t).then(y.resolve).catch(y.reject):y.resolve()},g.onerror=y.reject,E?this.handleHook(E,t).then((function(){return document.body.appendChild(g)})).catch(y.reject):document.body.appendChild(g)}return this.registry.get(this.stripUrlProtocol(e))},e.prototype.addElement=function(e){var t;return this.registry.set(this.stripUrlProtocol(e),new Promise((function(e,o){return t={resolve:e,reject:o}}))),t},e.prototype.hasElement=function(e){return this.registry.has(this.stripUrlProtocol(e))},e.prototype.stripUrlProtocol=function(e){return e.replace(/https?:\/\//,"")},e.prototype.isPromise=function(e){var t;return"function"==typeof(null===(t=e)||void 0===t?void 0:t.then)},e.prototype.handleHook=function(e,t){try{var o=e(t);return this.isPromise(o)?o:Promise.resolve()}catch(e){return Promise.reject(e)}},e}();s.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[a]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[n]}]}]},s.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new s(t.ɵɵinject(a),t.ɵɵinject(n,8))},token:s,providedIn:"root"});var c=function(){function e(e,t,o,r,n){this.vcr=e,this.template=t,this.elementsLoaderService=o,this.cfr=r,this.cdr=n,this.viewRef=null}return e.prototype.ngOnInit=function(){var e=this,t=this.template,o=t._declarationTContainer?t._declarationTContainer.tagName:t._def.element.template.nodes[0].element.name,r=this.elementsLoaderService.getElementConfig(o)||{},n=this.elementsLoaderService.options,i=r.loadingComponent||n.loadingComponent;if(this.loadingTemplateRef)this.vcr.createEmbeddedView(this.loadingTemplateRef);else if(i){var a=this.cfr.resolveComponentFactory(i);this.vcr.createComponent(a)}this.elementsLoaderService.loadElement(this.url,o,this.isModule,null==r?void 0:r.hooks).then((function(){return customElements.whenDefined(o)})).then((function(){e.vcr.clear(),e.viewRef=e.vcr.createEmbeddedView(e.template),e.cdr.markForCheck()})).catch((function(){e.vcr.clear();var t=r.errorComponent||n.errorComponent;if(e.errorTemplateRef)e.vcr.createEmbeddedView(e.errorTemplateRef),e.cdr.markForCheck();else if(t){var i=e.cfr.resolveComponentFactory(t);e.vcr.createComponent(i),e.cdr.markForCheck()}else console.error("@angular-extensions/elements - Loading of element <"+o+'> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElement="errorTemplate: error" to display customized error message in place of element')}))},e.prototype.destroyEmbeddedView=function(){this.viewRef&&!this.viewRef.destroyed&&(this.viewRef.detach(),this.viewRef.destroy(),this.viewRef=null)},e}();c.decorators=[{type:t.Directive,args:[{selector:"[axLazyElement]"}]}],c.ctorParameters=function(){return[{type:t.ViewContainerRef},{type:t.TemplateRef},{type:s},{type:t.ComponentFactoryResolver},{type:t.ChangeDetectorRef}]},c.propDecorators={url:[{type:t.Input,args:["axLazyElement"]}],loadingTemplateRef:[{type:t.Input,args:["axLazyElementLoadingTemplate"]}],errorTemplateRef:[{type:t.Input,args:["axLazyElementErrorTemplate"]}],isModule:[{type:t.Input,args:["axLazyElementModule"]}]};var d=function(){function e(e,t,o,r,n,i,a){this.document=e,this.renderer=t,this.vcr=o,this.cfr=r,this.cdr=n,this.template=i,this.elementsLoaderService=a,this.viewRef=null}return e.prototype.ngOnInit=function(){var e=this;if(!this.tag||0===this.tag.length||!this.tag.includes("-"))throw new Error('@angular-extensions/elements - Valid tag has to be specified when using *axLazyElementDynamic directive (use *axLazyElementDynamic="\'some-tag\'"), got: "'+this.tag+'"');var t=this.elementsLoaderService.getElementConfig(this.tag)||{},o=this.elementsLoaderService.options,r=t.loadingComponent||o.loadingComponent;if(this.loadingTemplateRef)this.vcr.createEmbeddedView(this.loadingTemplateRef);else if(r){var n=this.cfr.resolveComponentFactory(r);this.vcr.createComponent(n)}this.elementsLoaderService.loadElement(this.url,this.tag,this.isModule,null==t?void 0:t.hooks).then((function(){return customElements.whenDefined(e.tag)})).then((function(){e.vcr.clear();var t=e.renderer.createElement;e.renderer.createElement=function(t,o){return"ax-lazy-element"===t&&(t=e.tag),e.document.createElement(t)},e.viewRef=e.vcr.createEmbeddedView(e.template),e.renderer.createElement=t,e.cdr.markForCheck()})).catch((function(r){var n=t.errorComponent||o.errorComponent;if(e.vcr.clear(),e.errorTemplateRef)e.vcr.createEmbeddedView(e.errorTemplateRef),e.cdr.markForCheck();else if(n){var i=e.cfr.resolveComponentFactory(n);e.vcr.createComponent(i),e.cdr.markForCheck()}else console.error("@angular-extensions/elements - Loading of element <"+e.tag+'> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElementDynamic="errorTemplate: error" to display customized error message in place of element\n\n',r)}))},e.prototype.destroyEmbeddedView=function(){this.viewRef&&!this.viewRef.destroyed&&(this.viewRef.detach(),this.viewRef.destroy(),this.viewRef=null)},e}();function u(e){if(e)throw new TypeError("LazyElementsModule.forRoot() called twice. Feature modules should use LazyElementsModule.forFeature() instead.");return"LazyElementsModule.forRoot() multiple execution guard"}d.decorators=[{type:t.Directive,args:[{selector:"[axLazyElementDynamic]"}]}],d.ctorParameters=function(){return[{type:Document,decorators:[{type:t.Inject,args:[o.DOCUMENT]}]},{type:t.Renderer2},{type:t.ViewContainerRef},{type:t.ComponentFactoryResolver},{type:t.ChangeDetectorRef},{type:t.TemplateRef},{type:s}]},d.propDecorators={tag:[{type:t.Input,args:["axLazyElementDynamic"]}],url:[{type:t.Input,args:["axLazyElementDynamicUrl"]}],loadingTemplateRef:[{type:t.Input,args:["axLazyElementDynamicLoadingTemplate"]}],errorTemplateRef:[{type:t.Input,args:["axLazyElementDynamicErrorTemplate"]}],isModule:[{type:t.Input,args:["axLazyElementDynamicModule"]}]};var p=function(){function e(e,t,o){t&&t.length&&t.filter((function(e){return e.some((function(e){return!e.isAdded}))})).forEach((function(t){return e.addConfigs(t)}))}return e.forRoot=function(o){return{ngModule:e,providers:[{provide:r,useValue:o&&o.elementConfigs?o.elementConfigs:[],multi:!0},{provide:n,useValue:o.rootOptions?o.rootOptions:{}},{provide:i,useFactory:u,deps:[[n,new t.Optional,new t.SkipSelf]]}]}},e.forFeature=function(t){return{ngModule:e,providers:[{provide:r,useValue:t&&t.elementConfigs?t.elementConfigs:[],multi:!0}]}},e}();p.decorators=[{type:t.NgModule,args:[{declarations:[c,d],imports:[o.CommonModule],exports:[c,d],providers:[]}]}],p.ctorParameters=function(){return[{type:s},{type:Array,decorators:[{type:t.Optional},{type:t.Inject,args:[r]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[i]}]}]},e.LAZY_ELEMENTS_REGISTRY=a,e.LAZY_ELEMENT_CONFIGS=r,e.LAZY_ELEMENT_ROOT_GUARD=i,e.LAZY_ELEMENT_ROOT_OPTIONS=n,e.LazyElementDirective=c,e.LazyElementDynamicDirective=d,e.LazyElementsLoaderService=s,e.LazyElementsModule=p,e.createLazyElementRootGuard=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-extensions-elements.umd.min.js.map