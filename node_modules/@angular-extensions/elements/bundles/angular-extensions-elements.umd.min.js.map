{"version":3,"sources":["../../../projects/elements/src/lib/lazy-elements/lazy-elements.tokens.ts","../../../projects/elements/src/lib/lazy-elements/lazy-elements-loader.service.ts","../../../projects/elements/src/lib/lazy-elements/lazy-element/lazy-element.directive.ts","../../../projects/elements/src/lib/lazy-elements/lazy-element-dynamic/lazy-element-dynamic.directive.ts","../../../projects/elements/src/lib/lazy-elements/lazy-elements.module.ts"],"names":["LAZY_ELEMENT_CONFIGS","InjectionToken","LAZY_ELEMENT_ROOT_OPTIONS","LAZY_ELEMENT_ROOT_GUARD","LAZY_ELEMENTS_REGISTRY","providedIn","factory","Map","LOG_PREFIX","LazyElementsLoaderService","registry","options","this","configs","prototype","addConfigs","newConfigs","_this","forEach","newConfig","getElementConfig","tag","console","warn","isAdded","push","undefined","preload","loadElement","url","isModule","hooks","find","config","tags","filter","includes","hooksConfig","Error","hasElement","notifier_1","addElement","script_1","document","createElement","beforeLoadHook","_c","_a","beforeLoad","_b","_e","_d","afterLoadHook_1","_h","_f","afterLoad","_g","_k","_j","type","src","onload","handleHook","then","resolve","catch","reject","onerror","body","appendChild","get","stripUrlProtocol","notifier","set","Promise","has","replace","isPromise","obj","hook","result","err","Injectable","args","Inject","Optional","LazyElementDirective","vcr","template","elementsLoaderService","cfr","cdr","viewRef","ngOnInit","tpl","elementTag","_declarationTContainer","tagName","_def","element","nodes","name","elementConfig","loadingComponent","loadingTemplateRef","createEmbeddedView","resolveComponentFactory","createComponent","customElements","whenDefined","clear","markForCheck","errorComponent","errorTemplateRef","error","destroyEmbeddedView","destroyed","detach","destroy","Directive","selector","ViewContainerRef","TemplateRef","ComponentFactoryResolver","ChangeDetectorRef","Input","LazyElementDynamicDirective","renderer","length","originalCreateElement","namespace","createLazyElementRootGuard","rootOptions","TypeError","Document","decorators","DOCUMENT","Renderer2","LazyElementsModule","lazyElementsLoaderService","elementConfigsMultiProvider","guard","some","forRoot","ngModule","providers","provide","useValue","elementConfigs","multi","useFactory","deps","SkipSelf","forFeature","NgModule","declarations","imports","CommonModule","exports"],"mappings":"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","sourcesContent":["import { InjectionToken } from '@angular/core';\n\nimport { ElementConfig } from './lazy-elements-loader.service';\nimport { LazyElementRootOptions } from './lazy-elements.module';\n\nexport const LAZY_ELEMENT_CONFIGS = new InjectionToken<ElementConfig[]>(\n  'LAZY_ELEMENT_CONFIGS'\n);\n\nexport const LAZY_ELEMENT_ROOT_OPTIONS = new InjectionToken<\n  LazyElementRootOptions\n>('LAZY_ELEMENT_ROOT_OPTIONS');\n\nexport const LAZY_ELEMENT_ROOT_GUARD = new InjectionToken<void>(\n  'LAZY_ELEMENT_ROOT_GUARD'\n);\n\nexport const LAZY_ELEMENTS_REGISTRY = new InjectionToken<LazyElementsRegistry>(\n  'LAZY_ELEMENTS_REGISTRY',\n  {\n    providedIn: 'root',\n    factory: () => new Map<string, Promise<void>>(),\n  }\n);\n\nexport interface LazyElementsRegistry {\n  get: (url: string) => Promise<void>;\n  set: (url: string, notifier: Promise<void>) => void;\n  has: (url: string) => boolean;\n}\n","import { Injectable, Type, Optional, Inject } from '@angular/core';\n\nimport { LazyElementRootOptions } from './lazy-elements.module';\nimport {\n  LAZY_ELEMENT_ROOT_OPTIONS,\n  LAZY_ELEMENTS_REGISTRY,\n  LazyElementsRegistry,\n} from './lazy-elements.tokens';\n\nconst LOG_PREFIX = '@angular-extensions/elements';\n\nexport type Hook = (tag: string) => Promise<void> | void;\n\nexport interface HooksConfig {\n  beforeLoad?: Hook;\n  afterLoad?: Hook;\n}\n\nexport interface ElementConfig {\n  tag: string;\n  url: string;\n  isModule?: boolean;\n  loadingComponent?: Type<any>;\n  errorComponent?: Type<any>;\n  preload?: boolean;\n  hooks?: HooksConfig;\n  isAdded?: boolean;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class LazyElementsLoaderService {\n  configs: ElementConfig[] = [];\n\n  constructor(\n    @Inject(LAZY_ELEMENTS_REGISTRY) private registry: LazyElementsRegistry,\n    @Optional()\n    @Inject(LAZY_ELEMENT_ROOT_OPTIONS)\n    public options: LazyElementRootOptions\n  ) {\n    if (!options) {\n      this.options = {};\n    }\n  }\n\n  addConfigs(newConfigs: ElementConfig[]) {\n    newConfigs.forEach((newConfig) => {\n      const existingConfig = this.getElementConfig(newConfig.tag);\n      if (existingConfig) {\n        console.warn(\n          `${LOG_PREFIX} - ElementConfig for tag '${newConfig.tag}' was previously added, it will not be added multiple times, continue...`\n        );\n      } else {\n        newConfig.isAdded = true;\n        this.configs.push(newConfig);\n        const shouldPreload =\n          newConfig.preload !== undefined\n            ? newConfig.preload\n            : this.options.preload;\n        if (shouldPreload) {\n          this.loadElement(\n            newConfig.url,\n            newConfig.tag,\n            newConfig.isModule,\n            newConfig.hooks\n          );\n        }\n      }\n    });\n  }\n\n  getElementConfig(tag: string): ElementConfig {\n    return this.configs.find((config) => config.tag === tag);\n  }\n\n  preload(tags?: string[]) {\n    let configs = this.configs;\n    if (tags) {\n      configs = this.configs.filter((config) => tags.includes(config.tag));\n    }\n    configs.forEach((config) =>\n      this.loadElement(config.url, config.tag, config.isModule, config.hooks)\n    );\n  }\n\n  loadElement(\n    url: string,\n    tag: string,\n    isModule?: boolean,\n    hooksConfig?: HooksConfig\n  ): Promise<void> {\n    const config = this.getElementConfig(tag);\n\n    if (!url) {\n      if (!config || !config.url) {\n        throw new Error(`${LOG_PREFIX} - url for <${tag}> not found`);\n      }\n      url = config.url;\n    }\n\n    if (isModule === undefined) {\n      isModule =\n        config && config.isModule !== undefined\n          ? config.isModule\n          : this.options.isModule;\n    }\n\n    if (!tag) {\n      throw new Error(\n        `${LOG_PREFIX} - tag for '${url}' not found, the *axLazyElement has to be used on HTML element`\n      );\n    }\n\n    if (!this.hasElement(url)) {\n      const notifier = this.addElement(url);\n      const script = document.createElement('script') as HTMLScriptElement;\n      const beforeLoadHook =\n        hooksConfig?.beforeLoad ??\n        config?.hooks?.beforeLoad ??\n        this.options?.hooks?.beforeLoad;\n      const afterLoadHook =\n        hooksConfig?.afterLoad ??\n        config?.hooks?.afterLoad ??\n        this.options?.hooks?.afterLoad;\n      if (isModule) {\n        script.type = 'module';\n      }\n      script.src = url;\n      script.onload = () => {\n        if (afterLoadHook) {\n          this.handleHook(afterLoadHook, tag)\n            .then(notifier.resolve)\n            .catch(notifier.reject);\n        } else {\n          notifier.resolve();\n        }\n      };\n      script.onerror = notifier.reject;\n      if (beforeLoadHook) {\n        this.handleHook(beforeLoadHook, tag)\n          .then(() => document.body.appendChild(script))\n          .catch(notifier.reject);\n      } else {\n        document.body.appendChild(script);\n      }\n    }\n\n    return this.registry.get(this.stripUrlProtocol(url));\n  }\n\n  private addElement(url: string): Notifier {\n    let notifier: Notifier;\n    this.registry.set(\n      this.stripUrlProtocol(url),\n      new Promise<void>((resolve, reject) => (notifier = { resolve, reject }))\n    );\n    return notifier;\n  }\n\n  private hasElement(url: string): boolean {\n    return this.registry.has(this.stripUrlProtocol(url));\n  }\n\n  private stripUrlProtocol(url: string): string {\n    return url.replace(/https?:\\/\\//, '');\n  }\n\n  private isPromise<T>(obj: T | Promise<T>): obj is Promise<T> {\n    return typeof (obj as any)?.then === 'function';\n  }\n\n  private handleHook(hook: Hook, tag: string): Promise<void> {\n    try {\n      const result = hook(tag);\n      if (this.isPromise(result)) {\n        return result;\n      } else {\n        return Promise.resolve();\n      }\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  }\n}\n\ninterface Notifier {\n  resolve: () => void;\n  reject: (error: any) => void;\n}\n","import {\n  Directive,\n  Input,\n  OnInit,\n  TemplateRef,\n  ViewContainerRef,\n  ComponentFactoryResolver,\n  ChangeDetectorRef,\n  EmbeddedViewRef,\n} from '@angular/core';\n\nimport {\n  LazyElementsLoaderService,\n  ElementConfig,\n} from '../lazy-elements-loader.service';\n\nconst LOG_PREFIX = '@angular-extensions/elements';\n\n@Directive({\n  selector: '[axLazyElement]',\n})\nexport class LazyElementDirective implements OnInit {\n  @Input('axLazyElement') url: string;\n  @Input('axLazyElementLoadingTemplate') loadingTemplateRef: TemplateRef<any>; // tslint:disable-line:no-input-rename\n  @Input('axLazyElementErrorTemplate') errorTemplateRef: TemplateRef<any>; // tslint:disable-line:no-input-rename\n  @Input('axLazyElementModule') isModule: boolean | undefined; // tslint:disable-line:no-input-rename\n\n  private viewRef: EmbeddedViewRef<any> = null;\n\n  constructor(\n    private vcr: ViewContainerRef,\n    private template: TemplateRef<any>,\n    private elementsLoaderService: LazyElementsLoaderService,\n    private cfr: ComponentFactoryResolver,\n    private cdr: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    const tpl = this.template as any;\n    const elementTag = tpl._declarationTContainer\n      ? tpl._declarationTContainer.tagName\n      : tpl._def.element.template.nodes[0].element.name;\n\n    const elementConfig =\n      this.elementsLoaderService.getElementConfig(elementTag) ||\n      ({} as ElementConfig);\n    const options = this.elementsLoaderService.options;\n    const loadingComponent =\n      elementConfig.loadingComponent || options.loadingComponent;\n\n    if (this.loadingTemplateRef) {\n      this.vcr.createEmbeddedView(this.loadingTemplateRef);\n    } else if (loadingComponent) {\n      const factory = this.cfr.resolveComponentFactory(loadingComponent);\n      this.vcr.createComponent(factory);\n    }\n    this.elementsLoaderService\n      .loadElement(this.url, elementTag, this.isModule, elementConfig?.hooks)\n      .then(() => customElements.whenDefined(elementTag))\n      .then(() => {\n        this.vcr.clear();\n        this.viewRef = this.vcr.createEmbeddedView(this.template);\n        this.cdr.markForCheck();\n      })\n      .catch(() => {\n        this.vcr.clear();\n        const errorComponent =\n          elementConfig.errorComponent || options.errorComponent;\n        if (this.errorTemplateRef) {\n          this.vcr.createEmbeddedView(this.errorTemplateRef);\n          this.cdr.markForCheck();\n        } else if (errorComponent) {\n          const factory = this.cfr.resolveComponentFactory(errorComponent);\n          this.vcr.createComponent(factory);\n          this.cdr.markForCheck();\n        } else {\n          console.error(\n            `${LOG_PREFIX} - Loading of element <${elementTag}> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElement=\"errorTemplate: error\" to display customized error message in place of element`\n          );\n        }\n      });\n  }\n\n  destroyEmbeddedView() {\n    if (this.viewRef && !this.viewRef.destroyed) {\n      this.viewRef.detach();\n      this.viewRef.destroy();\n      this.viewRef = null;\n    }\n  }\n}\n","import {\n  Directive,\n  Input,\n  OnInit,\n  TemplateRef,\n  ViewContainerRef,\n  ComponentFactoryResolver,\n  ChangeDetectorRef,\n  Renderer2,\n  Inject,\n  EmbeddedViewRef,\n} from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\n\nimport {\n  LazyElementsLoaderService,\n  ElementConfig,\n} from '../lazy-elements-loader.service';\n\nconst LOG_PREFIX = '@angular-extensions/elements';\n\n/** @dynamic */\n@Directive({\n  selector: '[axLazyElementDynamic]',\n})\nexport class LazyElementDynamicDirective implements OnInit {\n  @Input('axLazyElementDynamic') tag: string;\n  @Input('axLazyElementDynamicUrl') url: string; // tslint:disable-line:no-input-rename\n  @Input('axLazyElementDynamicLoadingTemplate') loadingTemplateRef: TemplateRef<\n    any\n  >; // tslint:disable-line:no-input-rename\n  @Input('axLazyElementDynamicErrorTemplate') errorTemplateRef: TemplateRef<\n    any\n  >; // tslint:disable-line:no-input-rename\n  @Input('axLazyElementDynamicModule') isModule: boolean | undefined; // tslint:disable-line:no-input-rename\n\n  private viewRef: EmbeddedViewRef<any> = null;\n\n  constructor(\n    @Inject(DOCUMENT) private document: Document,\n    private renderer: Renderer2,\n    private vcr: ViewContainerRef,\n    private cfr: ComponentFactoryResolver,\n    private cdr: ChangeDetectorRef,\n    private template: TemplateRef<any>,\n    private elementsLoaderService: LazyElementsLoaderService\n  ) {}\n\n  ngOnInit() {\n    if (!this.tag || this.tag.length === 0 || !this.tag.includes('-')) {\n      throw new Error(\n        `${LOG_PREFIX} - Valid tag has to be specified when using *axLazyElementDynamic directive (use *axLazyElementDynamic=\"'some-tag'\"), got: \"${this.tag}\"`\n      );\n    }\n\n    const elementConfig =\n      this.elementsLoaderService.getElementConfig(this.tag) ||\n      ({} as ElementConfig);\n    const options = this.elementsLoaderService.options;\n    const loadingComponent =\n      elementConfig.loadingComponent || options.loadingComponent;\n\n    if (this.loadingTemplateRef) {\n      this.vcr.createEmbeddedView(this.loadingTemplateRef);\n    } else if (loadingComponent) {\n      const factory = this.cfr.resolveComponentFactory(loadingComponent);\n      this.vcr.createComponent(factory);\n    }\n\n    this.elementsLoaderService\n      .loadElement(this.url, this.tag, this.isModule, elementConfig?.hooks)\n      .then(() => customElements.whenDefined(this.tag))\n      .then(() => {\n        this.vcr.clear();\n        const originalCreateElement = this.renderer.createElement;\n        this.renderer.createElement = (name: string, namespace: string) => {\n          if (name === 'ax-lazy-element') {\n            name = this.tag;\n          }\n          return this.document.createElement(name);\n        };\n        this.viewRef = this.vcr.createEmbeddedView(this.template);\n        this.renderer.createElement = originalCreateElement;\n        this.cdr.markForCheck();\n      })\n      .catch((error) => {\n        const errorComponent =\n          elementConfig.errorComponent || options.errorComponent;\n        this.vcr.clear();\n        if (this.errorTemplateRef) {\n          this.vcr.createEmbeddedView(this.errorTemplateRef);\n          this.cdr.markForCheck();\n        } else if (errorComponent) {\n          const factory = this.cfr.resolveComponentFactory(errorComponent);\n          this.vcr.createComponent(factory);\n          this.cdr.markForCheck();\n        } else {\n          console.error(\n            `${LOG_PREFIX} - Loading of element <${this.tag}> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElementDynamic=\"errorTemplate: error\" to display customized error message in place of element\\n\\n`,\n            error\n          );\n        }\n      });\n  }\n\n  destroyEmbeddedView() {\n    if (this.viewRef && !this.viewRef.destroyed) {\n      this.viewRef.detach();\n      this.viewRef.destroy();\n      this.viewRef = null;\n    }\n  }\n}\n","import {\n  NgModule,\n  Optional,\n  Inject,\n  ModuleWithProviders,\n  Type,\n  SkipSelf,\n} from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { LazyElementDirective } from './lazy-element/lazy-element.directive';\nimport { LazyElementDynamicDirective } from './lazy-element-dynamic/lazy-element-dynamic.directive';\nimport {\n  ElementConfig,\n  LazyElementsLoaderService,\n  HooksConfig,\n} from './lazy-elements-loader.service';\nimport {\n  LAZY_ELEMENT_ROOT_OPTIONS,\n  LAZY_ELEMENT_CONFIGS,\n  LAZY_ELEMENT_ROOT_GUARD,\n} from './lazy-elements.tokens';\n\nexport function createLazyElementRootGuard(\n  rootOptions: LazyElementRootOptions\n) {\n  if (rootOptions) {\n    throw new TypeError(\n      `LazyElementsModule.forRoot() called twice. Feature modules should use LazyElementsModule.forFeature() instead.`\n    );\n  }\n  return 'LazyElementsModule.forRoot() multiple execution guard';\n}\n\n@NgModule({\n  declarations: [LazyElementDirective, LazyElementDynamicDirective],\n  imports: [CommonModule],\n  exports: [LazyElementDirective, LazyElementDynamicDirective],\n  providers: [],\n})\nexport class LazyElementsModule {\n  static forRoot(\n    options: LazyElementModuleRootOptions\n  ): ModuleWithProviders<LazyElementsModule> {\n    return {\n      ngModule: LazyElementsModule,\n      providers: [\n        {\n          provide: LAZY_ELEMENT_CONFIGS,\n          useValue:\n            options && options.elementConfigs ? options.elementConfigs : [],\n          multi: true,\n        },\n        {\n          provide: LAZY_ELEMENT_ROOT_OPTIONS,\n          useValue: options.rootOptions ? options.rootOptions : {},\n        },\n        {\n          provide: LAZY_ELEMENT_ROOT_GUARD,\n          useFactory: createLazyElementRootGuard,\n          deps: [[LAZY_ELEMENT_ROOT_OPTIONS, new Optional(), new SkipSelf()]],\n        },\n      ],\n    };\n  }\n\n  static forFeature(\n    options: LazyElementModuleOptions\n  ): ModuleWithProviders<LazyElementsModule> {\n    return {\n      ngModule: LazyElementsModule,\n      providers: [\n        {\n          provide: LAZY_ELEMENT_CONFIGS,\n          useValue:\n            options && options.elementConfigs ? options.elementConfigs : [],\n          multi: true,\n        },\n      ],\n    };\n  }\n\n  constructor(\n    lazyElementsLoaderService: LazyElementsLoaderService,\n    @Optional()\n    @Inject(LAZY_ELEMENT_CONFIGS)\n    elementConfigsMultiProvider: ElementConfig[][],\n    @Optional()\n    @Inject(LAZY_ELEMENT_ROOT_GUARD)\n    guard: any\n  ) {\n    if (elementConfigsMultiProvider && elementConfigsMultiProvider.length) {\n      elementConfigsMultiProvider\n        .filter((configs) => configs.some((config) => !config.isAdded))\n        .forEach((configs) => lazyElementsLoaderService.addConfigs(configs));\n    }\n  }\n}\n\nexport interface LazyElementModuleOptions {\n  elementConfigs?: ElementConfig[];\n}\n\nexport interface LazyElementModuleRootOptions {\n  elementConfigs?: ElementConfig[];\n  rootOptions?: LazyElementRootOptions;\n}\n\nexport interface LazyElementRootOptions {\n  loadingComponent?: Type<any>;\n  errorComponent?: Type<any>;\n  isModule?: boolean;\n  preload?: boolean;\n  hooks?: HooksConfig;\n}\n"]}